<% content_for(:breadcrumb) do %>
  <%= link_to "Dashboard", admin_root_path %> > <strong>Analytics</strong>
<% end %>

<h1 style="font-family: 'Crimson Text', serif; color: #3d2c1d; margin-bottom: 2rem;">Analytics & Reports</h1>

<!-- Overview Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
  <!-- Quotes Stats -->
  <div class="admin-stat-card" style="background: #f0ebe4; color: #3d2c1d; padding: 1.5rem; border: 1px solid #8b7355; border-radius: 12px;">
    <h3 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
      ðŸ“š Quotes Overview
    </h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div>
        <p style="margin: 0; font-size: 2rem; font-weight: bold;"><%= @analytics[:quotes][:total] %></p>
        <small style="opacity: 0.9;">Total Quotes</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:quotes][:this_week] %></p>
        <small style="opacity: 0.9;">This Week</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:quotes][:this_month] %></p>
        <small style="opacity: 0.9;">This Month</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:quotes][:average_length] %></p>
        <small style="opacity: 0.9;">Avg Length</small>
      </div>
    </div>
  </div>

  <!-- Users Stats -->
  <div class="admin-stat-card" style="background: #f0ebe4; color: #3d2c1d; padding: 1.5rem; border: 1px solid #8b7355; border-radius: 12px;">
    <h3 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
      ðŸ‘¥ Users Overview
    </h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div>
        <p style="margin: 0; font-size: 2rem; font-weight: bold;"><%= @analytics[:users][:total] %></p>
        <small style="opacity: 0.9;">Total Users</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:users][:this_week] %></p>
        <small style="opacity: 0.9;">This Week</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:users][:admins] %></p>
        <small style="opacity: 0.9;">Admins</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:users][:commentors] %></p>
        <small style="opacity: 0.9;">Commentors</small>
      </div>
    </div>
  </div>

  <!-- Activity Stats -->
  <div class="admin-stat-card" style="background: #f0ebe4; color: #3d2c1d; padding: 1.5rem; border: 1px solid #8b7355; border-radius: 12px;">
    <h3 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
      ðŸ“Š Activity Overview
    </h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div>
        <p style="margin: 0; font-size: 2rem; font-weight: bold;"><%= @analytics[:activity][:total_activities] %></p>
        <small style="opacity: 0.9;">Total Actions</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:activity][:last_24h] %></p>
        <small style="opacity: 0.9;">Last 24h</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:activity][:last_week] %></p>
        <small style="opacity: 0.9;">This Week</small>
      </div>
      <div>
        <p style="margin: 0; font-size: 1.2rem; font-weight: bold;"><%= @analytics[:activity][:recent_admin_actions] %></p>
        <small style="opacity: 0.9;">Admin Actions</small>
      </div>
    </div>
  </div>
</div>

<!-- Detailed Analytics -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
  <!-- Quotes by Book -->
  <div class="admin-section" style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.08); border: 1px solid #e8ded2;">
    <h3 style="margin: 0 0 1.0rem 0; color: #3d2c1d;">Quotes by Book</h3>
    <% @analytics[:quotes][:by_book].sort_by { |k, v| -v }.each do |book, count| %>
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #8b7355;">
        <span style="font-weight: 500; color: #3d2c1d;"><%= truncate(book, length: 30) %></span>
        <span style="background: #f0ebe4; color: #3d2c1d; padding: 0.25rem 0.75rem; border-radius: 16px; font-weight: bold;">
          <%= count %>
        </span>
      </div>
    <% end %>
    <% if @analytics[:quotes][:by_book].empty? %>
      <p style="text-align: center; color: #8b7355; padding: 2rem;">No quotes found</p>
    <% end %>
  </div>


</div>



<!-- Export Actions -->
<div style="background: #f0ebe4; border-radius: 12px; padding: 1.5rem; border: 1px solid #8b7355;">
  <h4 style="margin: 0 0 1rem 0; color: #3d2c1d;">Export & Reports</h4>
  <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
  <%= link_to "Export Quotes CSV", admin_quotes_path(format: :csv), 
    style: "background: #3d2c1d; color: #fefcfa; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500; border: 1px solid #2a1f14;" %>
  <%= link_to "Export Users CSV", admin_users_path(format: :csv), 
    style: "background: #8b7355; color: #fefcfa; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500; border: 1px solid #3d2c1d;" %>
  <%= link_to "View Activity Log", admin_activity_logs_path, 
    style: "background: #c9b79c; color: #3d2c1d; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; border: 1px solid #8b7355;" %>
  </div>
</div>
