<% content_for(:breadcrumb) do %>
  <%= link_to "Dashboard", admin_root_path %> > <strong>Import/Export</strong>
<% end %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
  <h1 style="color: #3d2c1d;">Import/Export Quotes</h1>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; max-width: 1200px;">
  
  <!-- Import Section -->
  <div class="admin-section">
    <div style="background: #f0ebe4; padding: 1rem; border-bottom: 1px solid #8b7355; margin: -1rem -1rem 1rem -1rem;">
      <h3 style="margin: 0; color: #3d2c1d;">ðŸ“¥ Import Quotes from CSV</h3>
    </div>
    
    <%= form_with url: admin_import_export_import_path, multipart: true, local: true, 
        style: "display: flex; flex-direction: column; gap: 1rem;" do |f| %>
      
      <div>
        <label for="csv_file" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #3d2c1d;">
          Select CSV File:
        </label>
        <%= f.file_field :csv_file, accept: ".csv", required: true,
            style: "width: 100%; padding: 0.5rem; border: 1px solid #8b7355; border-radius: 4px; background: #fefcfa;" %>
      </div>
      
      <div style="background: #f8f5f0; padding: 1rem; border-radius: 4px; border-left: 3px solid #8b7355;">
        <h4 style="margin: 0 0 0.5rem 0; color: #3d2c1d;">ðŸ“‹ CSV Format Requirements:</h4>
        <p style="margin: 0; font-size: 0.9rem; color: #5a4a3a;">
          Your CSV file must include these columns in this exact order:
        </p>
        <code style="display: block; margin: 0.5rem 0; padding: 0.5rem; background: #fff; border-radius: 3px; font-size: 0.8rem;">
          text,book,chapter,context,character,tags
        </code>
        <ul style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #5a4a3a;">
          <li><strong>text</strong> and <strong>book</strong> are required</li>
          <li>Other fields are optional</li>
          <li><strong>tags</strong> should be comma-separated (e.g., "wisdom,courage,hope")</li>
          <li>Duplicates (same text + book) will be skipped</li>
        </ul>
      </div>
      
      <%= f.submit "Import CSV", class: "admin-nav-link", 
          style: "width: 100%; padding: 0.75rem; text-align: center; margin-top: 0.5rem;" %>
    <% end %>
    
    <div style="margin-top: 1rem; padding: 0.75rem; background: #e8f4f8; border-radius: 4px; border-left: 3px solid #17a2b8;">
      <p style="margin: 0; font-size: 0.85rem; color: #0c5460;">
        <strong>ðŸ’¡ Tip:</strong> The import process will provide a detailed summary showing successful imports, 
        skipped duplicates, and any errors encountered.
      </p>
    </div>
  </div>

  <!-- Export Section -->
  <div class="admin-section">
    <div style="background: #f0ebe4; padding: 1rem; border-bottom: 1px solid #8b7355; margin: -1rem -1rem 1rem -1rem;">
      <h3 style="margin: 0; color: #3d2c1d;">ðŸ“¤ Export Quotes to CSV</h3>
    </div>
    
    <div style="display: flex; flex-direction: column; gap: 1rem;">
      
      <!-- Enhanced Export -->
      <div style="padding: 1rem; border: 1px solid #8b7355; border-radius: 4px; background: #fefcfa;">
        <h4 style="margin: 0 0 0.5rem 0; color: #3d2c1d;">ðŸ“Š Enhanced Export</h4>
        <p style="margin: 0 0 1rem 0; font-size: 0.9rem; color: #5a4a3a;">
          Includes all fields (text, book, chapter, context, character, tags) - 
          perfect for backup or re-importing.
        </p>
        <%= link_to "Download Enhanced CSV", admin_import_export_export_path, 
            class: "admin-nav-link", style: "display: inline-block; text-decoration: none;" %>
      </div>

      <!-- Basic Export -->
      <div style="padding: 1rem; border: 1px solid #8b7355; border-radius: 4px; background: #fefcfa;">
        <h4 style="margin: 0 0 0.5rem 0; color: #3d2c1d;">ðŸ“„ Basic Export</h4>
        <p style="margin: 0 0 1rem 0; font-size: 0.9rem; color: #5a4a3a;">
          Legacy format with basic fields (ID, text, book, chapter, character, created date).
        </p>
        <%= link_to "Download Basic CSV", admin_quotes_path(format: :csv), 
            class: "admin-nav-link", style: "display: inline-block; text-decoration: none;" %>
      </div>
      
    </div>
    
    <div style="margin-top: 1rem; padding: 0.75rem; background: #f0f8e8; border-radius: 4px; border-left: 3px solid #28a745;">
      <p style="margin: 0; font-size: 0.85rem; color: #155724;">
        <strong>âœ… Recommendation:</strong> Use the Enhanced Export for full data backup 
        and when preparing files for import.
      </p>
    </div>
  </div>

</div>

<!-- Statistics Section -->
<div class="admin-section" style="margin-top: 2rem;">
  <div style="background: #f0ebe4; padding: 1rem; border-bottom: 1px solid #8b7355; margin: -1rem -1rem 1rem -1rem;">
    <h3 style="margin: 0; color: #3d2c1d;">ðŸ“ˆ Database Statistics</h3>
  </div>
  
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
    
    <div style="padding: 1rem; background: #f8f5f0; border-radius: 4px; text-align: center;">
      <div style="font-size: 2rem; font-weight: bold; color: #3d2c1d;"><%= Quote.count %></div>
      <div style="font-size: 0.9rem; color: #5a4a3a;">Total Quotes</div>
    </div>
    
    <div style="padding: 1rem; background: #f8f5f0; border-radius: 4px; text-align: center;">
      <div style="font-size: 2rem; font-weight: bold; color: #3d2c1d;"><%= Quote.distinct.count(:book) %></div>
      <div style="font-size: 0.9rem; color: #5a4a3a;">Unique Books</div>
    </div>
    
    <div style="padding: 1rem; background: #f8f5f0; border-radius: 4px; text-align: center;">
      <div style="font-size: 2rem; font-weight: bold; color: #3d2c1d;"><%= Tag.count %></div>
      <div style="font-size: 0.9rem; color: #5a4a3a;">Total Tags</div>
    </div>
    
    <div style="padding: 1rem; background: #f8f5f0; border-radius: 4px; text-align: center;">
      <div style="font-size: 2rem; font-weight: bold; color: #3d2c1d;"><%= Quote.displayed.count %></div>
      <div style="font-size: 0.9rem; color: #5a4a3a;">Displayed Quotes</div>
    </div>
    
  </div>
</div>

<style>
  .admin-nav-link {
    background: #8b7355;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    text-decoration: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    font-size: inherit;
    transition: background-color 0.2s;
  }
  
  .admin-nav-link:hover {
    background: #6d5a47;
    color: white;
    text-decoration: none;
  }
  
  .admin-section {
    background: white;
    border: 1px solid #8b7355;
    border-radius: 8px;
    padding: 1rem;
  }
</style>
