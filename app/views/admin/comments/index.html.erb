<style>
  .admin-container {
    width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    min-height: 100vh;
  }

  .admin-header {
    background: rgba(245, 240, 232, 0.1);
    backdrop-filter: blur(2px);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    border: 2px solid #8b7355;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  .admin-header h1 {
    font-family: 'Cinzel', serif;
    color: #8b7355;
    font-size: 2.5rem;
    margin: 0;
    text-shadow: 0 2px 4px rgba(139, 115, 85, 0.3);
  }

  .filters-card {
    background: rgba(245, 240, 232, 0.1);
    backdrop-filter: blur(2px);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    border: 2px solid #8b7355;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .filters-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    align-items: end;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    font-weight: 600;
    color: #8b7355;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .form-control {
    padding: 0.75rem;
    border: 2px solid #d4c4a8;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    outline: none;
    border-color: #8b7355;
    box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.1);
  }

  .btn-filter {
    background: linear-gradient(135deg, #8b7355, #a0855b);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-filter:hover {
    background: linear-gradient(135deg, #6d5940, #8b7355);
    transform: translateY(-2px);
  }

  /* Table styles now handled by unified app-table system in application.css */

  /* User/date info styles now handled by unified app-table system */
  /* Empty state styles now handled by unified app-table system */

  .stats-summary {
    background: rgba(245, 240, 232, 0.1);
    backdrop-filter: blur(2px);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    border: 2px solid #8b7355;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
  }

  .stat-item {
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    padding: 1rem;
  }

  .stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #8b7355;
    display: block;
  }

  .stat-label {
    font-size: 0.9rem;
    color: #666;
    margin-top: 0.5rem;
  }
</style>

<div class="admin-container">
  <div class="admin-header">
    <h1>ðŸ’¬ Comments Management</h1>
  </div>

  <div class="stats-summary">
    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-number"><%= Comment.count %></span>
        <div class="stat-label">Total Comments</div>
      </div>
      <div class="stat-item">
        <span class="stat-number"><%= Comment.where("created_at > ?", Date.current).count %></span>
        <div class="stat-label">Today</div>
      </div>
      <div class="stat-item">
        <span class="stat-number"><%= Comment.where("created_at > ?", 1.week.ago).count %></span>
        <div class="stat-label">This Week</div>
      </div>
      <div class="stat-item">
        <span class="stat-number"><%= Comment.where("parent_id IS NOT NULL").count %></span>
        <div class="stat-label">Replies</div>
      </div>
    </div>
  </div>

  <div class="filters-card">
    <%= form_with url: admin_comments_path, method: :get, local: true, class: "filters-form" do |f| %>
      <div class="form-group">
        <%= f.label :search, "Search Content" %>
        <%= f.text_field :search, value: params[:search], placeholder: "Search in comments...", class: "form-control" %>
      </div>
      
      <div class="form-group">
        <%= f.label :user_id, "User" %>
        <%= f.select :user_id, 
            options_from_collection_for_select(User.joins(:comments).distinct.order(:email), :id, :email, params[:user_id]),
            { include_blank: "All Users" }, 
            { class: "form-control" } %>
      </div>
      
      <div class="form-group">
        <%= f.label :quote_id, "Quote ID" %>
        <%= f.number_field :quote_id, value: params[:quote_id], placeholder: "Enter Quote ID...", class: "form-control" %>
      </div>
      
      <div class="form-group">
        <label>&nbsp;</label>
        <%= f.submit "Apply Filters", class: "btn-filter" %>
      </div>
    <% end %>
  </div>

  <div class="app-table-section">
    <% if @comments.any? %>
      <table class="app-table" data-controller="sortable-table" aria-describedby="comments-table-caption">
        <caption id="comments-table-caption" class="sr-only">Comments table. Click on headers to sort.</caption>
        <thead>
          <tr>
            <th data-type="text" role="columnheader" tabindex="0" aria-sort="descending" style="outline: none;">Content</th>
            <th data-type="text" role="columnheader" tabindex="0" aria-sort="none" style="outline: none;">User</th>
            <th data-type="text" role="columnheader" tabindex="0" aria-sort="none" style="outline: none;">Quote</th>
            <th data-type="date" role="columnheader" tabindex="0" aria-sort="none" style="outline: none;">Created</th>
            <th data-type="text" role="columnheader" tabindex="0" aria-sort="none" style="outline: none;">Type</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @comments.each do |comment| %>
            <tr tabindex="0" aria-label="Comment by <%= comment.user_display_name %>">
              <td class="content-preview">
                <div title="<%= comment.content %>">
                  <%= truncate(comment.content, length: 100) %>
                </div>
              </td>
              <td>
                <div class="user-info">
                  <%= comment.user_display_name %>
                </div>
                <div class="secondary-info">
                  <%= comment.user_email || "N/A" %>
                </div>
              </td>
              <td>
                <div class="user-info">
                  Quote #<%= comment.quote.id %>
                </div>
                <div class="secondary-info">
                  "<%= truncate(comment.quote.text, length: 50) %>"
                </div>
              </td>
              <td class="date-cell" data-sort-value="<%= comment.created_at.iso8601 %>">
                <div class="secondary-info">
                  <%= time_ago_in_words(comment.created_at) %> ago
                </div>
                <div class="secondary-info">
                  <%= comment.created_at.strftime("%b %d, %Y at %I:%M %p") %>
                </div>
              </td>
              <td>
                <% if comment.parent_id %>
                  <span class="status-badge" style="background: rgba(108, 117, 125, 0.1); color: #6c757d;">Reply</span>
                <% else %>
                  <span class="status-badge">Comment</span>
                <% end %>
              </td>
              <td>
                <%= link_to "Delete", admin_comment_path(comment), 
                    method: :delete,
                    class: "action-link",
                    style: "color: #dc3545; font-weight: 500;",
                    data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this comment? This action cannot be undone." } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="empty-state">
        <h3>No Comments Found</h3>
        <p>
          <% if params.values.any?(&:present?) %>
            Try adjusting your filters or <%= link_to "clear all filters", admin_comments_path, class: "action-link" %>.
          <% else %>
            No comments have been posted yet.
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</div>
